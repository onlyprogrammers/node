import{record as e,EventType as t,pack as n,MouseInteractions as r}from"zipy-rrweb";import{v4 as o}from"uuid";import{strToU8 as i,zlibSync as s,strFromU8 as a}from"fflate";var c,u,d;!function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.ReplayerEvent=11]="ReplayerEvent",e[e.ConsoleInfo=50]="ConsoleInfo",e[e.ConsoleError=51]="ConsoleError",e[e.ConsoleWarning=52]="ConsoleWarning",e[e.ConsoleDebug=53]="ConsoleDebug",e[e.Error=70]="Error",e[e.RangeError=71]="RangeError",e[e.ReferenceError=72]="ReferenceError",e[e.TypeError=73]="TypeError",e[e.SyntaxError=74]="SyntaxError",e[e.URIError=75]="URIError",e[e.EvalError=76]="EvalError",e[e.UnhandledRejection=77]="UnhandledRejection",e[e.BROWSERDATA=100]="BROWSERDATA",e[e.NAVIGATION=101]="NAVIGATION",e[e.Online=102]="Online",e[e.Offline=103]="Offline",e[e.XHR=104]="XHR",e[e.WSOPEN=105]="WSOPEN",e[e.WSCLOSE=106]="WSCLOSE",e[e.WSMESSAGE=107]="WSMESSAGE",e[e.WSERROR=108]="WSERROR",e[e.Fonts=109]="Fonts",e[e.Link=110]="Link",e[e.Css=111]="Css",e[e.Image=112]="Image",e[e.Js=113]="Js",e[e.Media=114]="Media",e[e.ZipyLogMessage=115]="ZipyLogMessage",e[e.ZipyLogException=116]="ZipyLogException",e[e.ZipyLogFrontendError=117]="ZipyLogFrontendError",e[e.ZipyLogNetworkError=118]="ZipyLogNetworkError",e[e.Performance=119]="Performance",e[e.PerfNavigation=120]="PerfNavigation",e[e.OtherNetworkCall=121]="OtherNetworkCall"}(c||(c={})),function(e){e[e.MESSAGESEND=0]="MESSAGESEND",e[e.MESSAGERECEIVED=1]="MESSAGERECEIVED",e[e.SOCKETCLOSE=2]="SOCKETCLOSE",e[e.SOCKETERROR=3]="SOCKETERROR",e[e.SOCKETOPEN=4]="SOCKETOPEN"}(u||(u={})),function(e){e[e.ELEMENT=0]="ELEMENT",e[e.EVENT=1]="EVENT",e[e.FIRST_INPUT=2]="FIRST_INPUT",e[e.LARGEST_CONTENTFUL_PAINT=3]="LARGEST_CONTENTFUL_PAINT",e[e.LAYOUT_SHIFT=4]="LAYOUT_SHIFT",e[e.LONGTASK=5]="LONGTASK",e[e.MARK=6]="MARK",e[e.MEASURE=7]="MEASURE",e[e.NAVIGATION=8]="NAVIGATION",e[e.PAINT=9]="PAINT",e[e.RESOURCE=10]="RESOURCE"}(d||(d={}));var l,f,p,g="zipy",v="rrweb";!function(e){e[e.POSTENDUSERINFOANDGETUSERCONFIG=0]="POSTENDUSERINFOANDGETUSERCONFIG",e[e.POSTENDUSERINFO=1]="POSTENDUSERINFO",e[e.GETUSERCONFIG=2]="GETUSERCONFIG"}(l||(l={})),function(e){e[e.ANONYMS=0]="ANONYMS",e[e.IDENTIFIED=1]="IDENTIFIED"}(f||(f={})),function(e){e[e.NORECORDING=0]="NORECORDING",e[e.RECORDINGPENDING=1]="RECORDINGPENDING",e[e.RECORDINGSUCCESSFUL=2]="RECORDINGSUCCESSFUL"}(p||(p={}));var y,m,w,h,E="logEvent",S="exceptionEvent",z="errorEvent",I=1024,k="startIframeRecording",C="stopIframeRecording",N="iframeContentLoaded";(h=y||(y={})).DEBUG="1",h.WARNING="2",h.ERROR="3",h.LOG="4",function(e){e[e.BLOCKING=0]="BLOCKING",e[e.NON_BLOCKING=1]="NON_BLOCKING"}(m||(m={})),function(e){e.session_data="_zsession-data",e.total_data_sent="_ztotal-data-sent",e.enduser_last_activity_time="_zenduser-last-activity-time",e.last_activity_time="_zlast-activity-time"}(w||(w={}));var R=/^(?!-)[A-Za-z0-9-]+([\-\.]{1}[a-z0-9]+)*\.[A-Za-z]{2,6}$/,b={streamMgrUrl:"https://services.zipy.ai/sdk-session-manager/v2/enduser-info",registerSessionUrl:"https://services.zipy.ai/sdk-session-manager/v1/register-sdk-session",sdkVersion:"1.0.6",errorUrl:"divolte.collector",streamMgrRetryCount:5,zipyDeploymentEnviornment:"Production",sdkLoopTime:1e3,perfLoopTime:5e3,ignoreEmptyErros:!0,ignoreLargeResponse:!0,debugLogs:!1,sessionLinkUrl:"https://app.zipy.ai"},O=!1;function T(e){O&&console.info(g,e)}function U(e){O&&console.debug(g,e)}function D(e){O&&console.log(g,e)}function x(e){O&&console.error(g,e)}function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P.apply(this,arguments)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function L(e,t,n){return L=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_(o,n.prototype),o},L.apply(null,arguments)}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function F(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function M(){return Date.now()}function q(e,t,n){var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}function G(){var e=Math.floor(Date.now()/1e3);return o()+"-"+e}function B(e){var t={externalId:"enduser_external_id",firstName:"eu_first_name",lastName:"eu_last_name",email:"eu_email",age:"eu_age",customerName:"eu_customer_name",avatar:"eu_avatar",phone:"eu_phone"};return e in t?t[e]:e}var J={domCapture:!0,consoleCapture:!0,networkCapture:!0,stackTraceCapture:!0,webSocketsCapture:!1,ipCapture:!0,inputMasking:!0,textMasking:!0,paid:!1,apiKey:"",streamUrl:"https://collector.zipy.ai",perfUrl:"https://perfcollector.zipy.ai",heatMapUrl:"https://heatmapcollector.zipy.ai",maxBufferSize:5e6,compression:!0,compressionType:"gzip",timeFrequency:1e3,perfTimeFrequency:5e3,clickTimeFrequency:1e3,encodingType:"",sessionTimeout:18e5,failureRetryCount:5,bufferSizeFrequency:1048576,perfBufferSizeFrequency:1024,clickBufferSizeFrequency:1024,ignoreUrl:["google.com","zipy.ai","mixpanel","extreme-ip-lookup.com","hotjar","smartlook.com","newrelic.com","bugsnag","fullstory","sentry.io","google-analytics.com","bam.nr-data.net","wistia.com","amplitude.com","segment.io","pendo.io","raygun","smartlook.cloud","segment.com","visualstudio.com","stats.g.doubleclick.net","pagead2.googlesyndication.com","r.lr-in.com","clarity.ms","appcues.net","datadoghq.com"],ignoreError:["rrweb","zipy","Script error","pagead2.googlesyndication.com","adsbygoogle"],ignoreConsole:["{}"],isIgnoreUrlError:["google.com","zipy.ai","mixpanel","extreme-ip-lookup.com","hotjar","smartlook.com","newrelic.com","bugsnag","fullstory","sentry.io","google-analytics.com","bam.nr-data.net","wistia.com","amplitude.com","segment.io","pendo.io","raygun","smartlook.cloud","segment.com","visualstudio.com","stats.g.doubleclick.net","pagead2.googlesyndication.com","r.lr-in.com","clarity.ms","appcues.net","datadoghq.com"],isIgnoreConsoleError:["{}"],ip:"",pack:!1,blockClasses:"zipy-block",xhrReqPayloadCapture:!1,xhrRespPayloadCapture:!1,canvasCapture:!1,scrubbingKey:["password","secret","passwd","api_key","apikey","access_token","auth","credentials","mysql_pwd","stripetoken","cardnumber"],requestCapSize:1e6,responseCapSize:1e6,sizeExceededMessage:{message:"size too large",source:"zipy"},eventCountCapInSingleChunk:0,captureCustomZipyLogMessage:!1,captureCustomZipyLogError:!1,captureCustomZipyLogException:!1,startCaptureWithoutUserActivity:!1,consoleLogLevel:"3",recordCrossOriginIframes:!0,splitSessionSize:0,capturePerformance:!1,captureClickEvents:!1,isApiIdentifierEnable:!1,apiUniqueIdentifier:[],ignoreUrlErrorCodes:{},ignoreUrlCodes:{},sessionStitching:!1};function Z(e){return P({},e,{timestamp:M()})}function j(){try{return window.sdkConfig?window.sdkConfig:J}catch(e){return x("Failed to parse end user Info data"),J}}function H(e){try{var t=j();return t&&t.hasOwnProperty&&t.hasOwnProperty(e)?t[e]:null}catch(e){return x(e.message?JSON.stringify(e):e),null}}var W=function(e,t,n){return e&&e.constructor===String&&n.indexOf(e)===t},K=function(e){return e&&e.constructor===String&&e.trim()};function V(){var e=H("headersToSanitize");return e&&e.length?e.split(","):[]}function X(e){if(!Array.isArray(e))return[];for(var t,n=[],r=F(e);!(t=r()).done;){var o=t.value;try{o&&"object"==typeof o&&JSON.stringify(o)?o.constructor.name.toLowerCase().includes("error")?n.push({message:o.message,name:o.name,stack:o.stack}):n.push(o):n.push(String(o))}catch(e){n.push("[console log value cannot be serialized]")}}return n}var Y=[];try{Y=H("scrubbingKey")||[]}catch(e){x("Error in obtaining scrubbing keys"),Y=J.scrubbingKey}function $(e,t,n){n++;try{e&&"object"==typeof e&&n<=2&&Object.keys(e).forEach(function(r){Y.includes(r.toLowerCase())&&(e[r]="xxx"),t.push(r);var o=e[r];"object"==typeof o&&$(o,t,n)})}catch(e){x("error while hiding the sensitive information: "+e)}return JSON.stringify(e)}function Q(e,t,n,r){var o=r?e.request:e.response,i=H(r?"xhrReqPayloadCapture":"xhrRespPayloadCapture"),s=function(t){try{r?(e.request=t,""!=e.request&&(e.requestByteSize=n)):(e.response=t,""!=e.response&&(e.responseByteSize=n))}catch(e){x("error while converting xhr data to string"+e)}};if(i){var a=H("responseCapSize")||1e6,c=H("requestCapSize")||1e6,u=r?c:a,d=H("sizeExceededMessage");"string"==typeof o&&o.length>0?(n=n||o.length)<=u?function(){try{s($(JSON.parse(o),[],t))}catch(t){var e=Y.some(function(e){return o.indexOf(e)>=0});s(o=r?e?"No request payload captured for this request as you may have some sensitive information in the payload.":o:e?"No response captured for this request as you may have some sensitive information in the payload.":o)}}():n>0&&s(JSON.stringify(d)):"object"==typeof o?(n=n||JSON.stringify(o,null,4).length)<=u?s($(o,[],t)):n>0&&s(d):o&&o.length>0&&((n=n||o.length)<=u?s($(o,[],t)):n>0&&s(JSON.stringify(d)))}else r?e.request="":e.response="";return e}function ee(e){if(!e)return!1;var t=e.toLowerCase(),n=H("ignoreError")||[];try{if(n.some(function(e){return t.includes(e.toLowerCase())}))return U("Ignoring error for data: "+e),!0}catch(e){x("Error in ignore errors. Error - "+e.message)}return!1}function te(){try{return window.self!==window.top}catch(e){return!0}}var ne=function(e){try{return Promise.resolve(new Promise(function(t,n){try{var r=function(e){t(o)},o="",i=function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}(function(){var t;if(!e||"Response"!==(null==e||null==(t=e.constructor)?void 0:t.name))throw new Error("No valid Response object to process!");return Promise.resolve(null==e?void 0:e.text()).then(function(e){(o=e)&&o.length&&(o=JSON.parse(o))})},function(e){x("Error while getting json of response: "+e.message)});return Promise.resolve(i&&i.then?i.then(r):r())}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}};function re(e,t){if(e&&null!=e)try{var n="";n="string"!=typeof e?JSON.stringify(e):e;for(var r=c.RangeError;r<=c.EvalError;r++)if(-1!=n.search(c[r]))return r}catch(e){x(e)}return t}function oe(e){switch(e){case"link":case"css":return c.Link;case"img":case"image":return c.Image;case"script":return c.Js;case"fetch":case"beacon":case"xmlhttprequest":return c.XHR;case"other":return c.OtherNetworkCall;default:return 0}}var ie,se=["img","script","css","link","image","script"];function ae(e,t,n){try{var r,o=H("isIgnoreUrlError"),i=H("ignoreUrl"),s=H("ignoreUrlErrorCodes"),a=H("ignoreUrlCodes"),c={};n?(r=o,c=s||{}):(r=i,c=a||{});var u=e.indexOf("?");u>0&&(e=e.substr(0,u));var d=function(e,n){return!!e.includes(n.toLowerCase())&&function(e){return!c.hasOwnProperty(e)||c[e].includes(t)}(n)},l=e.toLowerCase(),f=function(e){try{var t=e.match(/\/\d+\//g);if(t)for(var n,r=F(t);!(n=r()).done;)e=e.replace(n.value,"/{id}/")}catch(e){x("Error while masking numeric value.")}return e}(e.toLowerCase());if(r.some(function(e){return e.includes("{id}")?d(f,e):d(l,e)}))return!0}catch(t){x("Error in url decoding for url : "+e+" Error is - "+t)}return!1}function ce(e){return{initiatorType:e.initiatorType,nextHopProtocol:e.nextHopProtocol,workerStart:e.workerStart,redirectStart:e.redirectStart,redirectEnd:e.redirectEnd,fetchStart:e.fetchStart,domainLookupStart:e.domainLookupStart,domainLookupEnd:e.domainLookupEnd,connectStart:e.connectStart,connectEnd:e.connectEnd,secureConnectionStart:e.secureConnectionStart,requestStart:e.requestStart,responseStart:e.responseStart,responseEnd:e.responseEnd,transferSize:e.transferSize,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize,responseStatus:e.responseStatus,renderBlockingStatus:e.renderBlockingStatus,duration:e.duration,entryType:e.entryType,name:e.name,startTime:e.startTime}}function ue(e,t){return!(e.indexOf("http://")>-1||e.indexOf("https://")>-1)&&new URL(t).pathname===e}function de(e){if("online"!=(navigator.onLine?"online":"offline")){if(!window.iszInternetDisconnected)return window.iszInternetDisconnected=!0,U("handleConnectionChange :: send internet disconnected"),e(Z({eventType:c.Offline,data:{status:"Offline",type:""},isError:!1}))}else var t=setInterval(function(){fetch("//google.com",{mode:"no-cors"}).then(function(){return window.iszInternetDisconnected&&(window.iszInternetDisconnected=!1,U("handleConnectionChange :: send internet connected"),e(Z({eventType:c.Online,data:{status:"Online",type:""},isError:!1}))),clearInterval(t)}).catch(function(){window.iszInternetDisconnected||(window.iszInternetDisconnected=!0,U("handleConnectionChange :: send internet disconnected"),e(Z({eventType:c.Offline,data:{status:"Offline",type:""},isError:!1})))})},5e3)}var le=new Map;function fe(e){try{var t=window.localStorage.getItem(e);return!t&&(T("fetched value from hashmap :"+(t=le.get(e))),t)?(T("Going to update local storage:"),function(){try{T("inside localStorageUpdate function");for(var e,t=F(le.entries());!(e=t()).done;){var n=e.value;pe(n[0],n[1])}}catch(e){x("inside updateLocalStorage catch block ${e.message}")}}(),t):t}catch(e){return void x("inside zLocalStorageGetItem catch block ${e.message}")}}function pe(e,t){try{T("inside zLocalStorageSetItem for key :"+e+" and value :"+t),le.set(e,t),window.localStorage.setItem(e,t)}catch(e){x("inside zLocalStorageSetItem catch block ${e.message}")}}function ge(e){try{T("inside zLocalStorageRemoveItem for key :"+e),le.delete(e),window.localStorage.removeItem(e)}catch(e){x("inside zLocalStorageSetItem catch block ${e.message}")}}function ve(){var e=fe("zsdk-config");if(e)try{return JSON.parse(e)}catch(e){return void x("Failed to parse sdk Config Data")}}function ye(e){if(e)try{T("Updating zsession-blocked-info"+JSON.stringify(e)),pe("zsession-blocked-info",JSON.stringify(e))}catch(e){x("Failed to stringify zsession-blocked-info ")}}function me(e){var t={isBlocked:!1,blockedEndTime:0,apiKey:e};try{window.zSessionBlockedInfo=t,T("Updating zsession-blocked-info"+JSON.stringify(t)),pe("zsession-blocked-info",JSON.stringify(t))}catch(e){x("Failed to stringify zsession-blocked-info ")}}function we(){var e=fe("zsession-blocked-info");if(e)try{var t=JSON.parse(e);return window.zSessionBlockedInfo=t,t}catch(e){return void x("Failed to parse zsession-blocked-info")}}function he(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var Ee=function e(t,n,r,o,i){void 0===n&&(n=5),void 0===i&&(i={});try{return Promise.resolve(he(function(){var s=new URL(t);return null!=r&&Object.keys(r).forEach(function(e){return s.searchParams.append(e,r[e])}),Promise.resolve(fetch(s.href,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).then(function(s){return s.ok?(U("postDataOnServer :: Response status = "+s.status),Promise.resolve(s.json()).then(function(e){return U("postDataOnServer :: Response JSON = "+e),e})):404==s.status?(pe("is-api-key-valid","false"),Ne(!1),!1):(U("Error :: Response status = "+s.status),n>0?e(t,n-1,r,o,i):(x("Not able to post enduser config after multiple retries"),!1))})},function(e){return x("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},Se=function e(t,n,r){try{return Promise.resolve(he(function(){return Promise.resolve(fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip"},body:JSON.stringify(n)})).then(function(o){return o.ok?(U("Response status = "+o.status),!0):(U("Error :: Response status = "+o.status),r>0?e(t,n,r-1):(x("Not able to send data after all retries"),!1))})},function(e){return x("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},ze=function e(t,n,r){try{return Promise.resolve(he(function(){return Promise.resolve(fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip"},body:JSON.stringify(n)})).then(function(o){return o.ok?(U("Response status = "+o.status),!0):(U("Error :: Response status = "+o.status),r>0?e(t,n,r-1):(x("Not able to send data after all retries"),!1))})},function(e){return x("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},Ie=function t(n){var r=n.divolteUrl,o=n.divolteJson,i=n.failureRetryCount;try{return Promise.resolve(he(function(){var n=JSON.stringify(o);return Promise.resolve(fetch(r,{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip"},body:n})).then(function(s){if(j()&&j().splitSessionSize>0){var a=(new TextEncoder).encode(n).byteLength;D("Request size "+a),function(t){try{var n=fe("ztotal-data-sent")?fe("ztotal-data-sent"):"0",r=parseInt(n)+t;D("Current data size "+n),D("Merged data size "+r),r>j().splitSessionSize?(function(){try{D("Trigger checkout flow triggered"),e.takeFullSnapshot(!0)}catch(e){x("Error in checking full snapshot. Error is - "+e.message)}}(),pe("ztotal-data-sent","0"),D("Resetting data to size zero")):pe("ztotal-data-sent",JSON.stringify(r))}catch(e){x("Error in checking data size. Error is - "+e.message)}}(a)}return s.ok?(U("Response status = "+s.status),!0):(U("Error :: Response status = "+s.status),i>0?t({divolteUrl:r,divolteJson:o,failureRetryCount:i-1}):(x("Not able to send data after all retries"),!1))})},function(e){return x("Not able to get response from server with ERROR: "+e),!1}))}catch(e){return Promise.reject(e)}},ke=!0;function Ce(){return ke}function Ne(e){ke=e}function Re(){var e=fe("session-data");if(e)try{return JSON.parse(e)}catch(e){return void x("Failed to parse session data")}}function be(e){if(window.iszSessionExpired)return U("Session is already expired"),!0;var t=(Re()||{}).sessionId,n=Number(fe("last-activity-time"));return!t||n+e.sessionTimeout<=Date.now()?(T("Session is expired"),window.iszSessionExpired=!0,!0):!function(e){var t=Oe();return!(!t||t+e.sessionTimeout<=Date.now())}(e)}function Oe(){try{var e=window.zenduserLastActivityTime;if(!e){if(!(e=fe("zenduser-last-activity-time")))return 0;e=Number(e)}return e}catch(e){return x("inside getZendUserActivityTime catch block"),0}}function Te(){var e=fe("pack");if(!e){var t=j();pe("pack",e=t.pack?t.pack.toString():(!1).toString())}return"true"===e}function Ue(e){var t=fe("zId");t||pe("zId",t=G());var n=G(),r="0:"+G().replace("-",":");!function(e){ge("pack"),me(e)}(e),ge("pack");var o={sessionId:n,dSession:r,isNewSession:!0,sdkKey:e,isActive:!1};pe("is-api-key-valid","true"),Ne(!0);try{T("Created new Session"+JSON.stringify(o)),pe("session-data",JSON.stringify(o)),pe("last-activity-time",Date.now().toString()),window.iszSessionExpired=!1}catch(e){x("Failed to stringify  session data")}}function De(e){var t=Re();return!!t&&e!==(null==t?void 0:t.sdkKey)&&(T("Sdk key is chnaged going to create session data"),!0)}function xe(){var e=fe("zId");return e||(pe("zId",e=G()),e)}function Pe(){var e=fe("zenduser-info");if(e)try{return JSON.parse(e)}catch(e){return void x("Failed to parse end user Info data")}}function _e(){var e=fe("zenduser-info-temp");if(e)try{return JSON.parse(e)}catch(e){return void x("Failed to parse end user Info data")}}function Le(e){xe(),Pe()||T("Creating new enduser-info"+JSON.stringify(e));try{T("Updating enduser-info"+JSON.stringify(e)),pe("zenduser-info",JSON.stringify(e))}catch(e){x("Failed to stringify  enduser-info ")}}function Ae(e){xe(),Pe()||T("Creating new enduser-info-temp"+JSON.stringify(e));try{T("Updating enduser-info-temp"+JSON.stringify(e)),pe("zenduser-info-temp",JSON.stringify(e))}catch(e){x("Failed to stringify  enduser-info-temp ")}}function Fe(){_e()?(T("Removing zenduser-info-temp"),ge("zenduser-info-temp")):T("zenduser temp Data dosen't exists")}function Me(e,t){e.euId=0,e.euZName="",e.isBlocked=!1,e.zAnonymsUserInfo={euId:0,euZName:"",zId:null!=t?t:""}}function qe(e,t){var n,r,o=xe();(null==e||null==(n=e.zAnonymsUserInfo)?void 0:n.zId)===o?(T("ZId match"),e.euId=e.zAnonymsUserInfo.euId,e.euZName=e.zAnonymsUserInfo.euZName):(T("ZId dosen't match Zid : "+o+" and Anonyms user Zid: "+(null==e||null==(r=e.zAnonymsUserInfo)?void 0:r.zId)),Me(e,o)),t?Ae(e):Le(e)}function Ge(){if(_e())return T("Temp storage has some pending data to post"),!0;var e=Pe();if(!e)return T("zenduser Data dosen't exists"),!0;if(0===e.euId)return T("Euid value is 0, required to fetch data again"),!0;if(e.userType===f.ANONYMS){var t,n;if(null==e||null==(t=e.zExternalUserInfo)?void 0:t.externalId)return T("External User details exists, and userType is ANONYMS need to post data"),!0;var r=xe();if((null==(n=e.zAnonymsUserInfo)?void 0:n.zId)!==r)return T("ZId dosen't match Zid : "+r+" and Anonyms user Zid: "+e.zAnonymsUserInfo.zId),Me(e,r),Le(e),!0;T("ZId match No need to update for anonyms user")}return!1}var Be=function(e,t,n){void 0===t&&(t=0);try{var r={v:b.sdkVersion,e:"Production",o:t,ns:n};if(t==l.POSTENDUSERINFOANDGETUSERCONFIG||t==l.GETUSERCONFIG){var o=ve();window.sdkConfig=o||J}var i=we();if(i&&i.isBlocked)return T("Not going to call post end user info as session is already blocked"),Promise.resolve(window.sdkConfig);window.iszHandshakeDone=!1,window.zpendingOp=t,U("config.sdkversion"+b.sdkVersion);var s=_e()||{zAnonymsUserInfo:{}},a={},c=f.ANONYMS;if(s){var u,d=s.zExternalUserInfo||{};for(var p in d)a[B(p)]=d[p]?d[p]:"";a.enduser_zipy_id=null==(u=s.zAnonymsUserInfo)?void 0:u.zId,d.externalId&&(T("Get User info for user Type Identified "+d.externalId),c=f.IDENTIFIED)}return window.ztryForHandshake=!1,Promise.resolve(Ee(b.streamMgrUrl+"/"+e,b.streamMgrRetryCount,r,a)).then(function(n){if(n)if((null==n?void 0:n.api_key)==e){var r=we(),o=Re()||{},i=!(null==n||!n.is_blocked)&&(null==n?void 0:n.is_blocked);if(r&&(r.isBlocked||o.isActive||Xe(n,e)),i)return window.sdkConfig;if(t==l.POSTENDUSERINFOANDGETUSERCONFIG||t==l.GETUSERCONFIG){var a=Ve(n);window.iszHandshakeDone=!0,T("sdkConfigResp"+JSON.stringify(a)),a&&(window.sdkConfig=a)}if(t==l.POSTENDUSERINFOANDGETUSERCONFIG||t==l.POSTENDUSERINFO){var u=n.enduser_info||{};T("Response object received for End User from stream manager: "+JSON.stringify(u)),u&&(T("Going to add enduser info after data parsing"),s.userType=c,s.euId=u.id?u.id:0,s.euZName=u.zipy_eu_name?u.zipy_eu_name:"",s.isBlocked=!!u.is_blocked&&u.is_blocked,c==f.ANONYMS&&(s.zAnonymsUserInfo.euId=s.euId,s.zAnonymsUserInfo.euZName=s.euZName,s.zExternalUserInfo={}),Le(s),Fe())}}else x("Not able to get response from stream manager for sdk Key: "+e);else x("Not able to get response from stream manager ");return window.sdkConfig})}catch(e){return Promise.reject(e)}},Je=function(e){try{var t,n=j(),o=window.zClickEventsData||[],i="";try{i=JSON.stringify(o)}catch(e){x("Failed to stringify zEvents")}var s=o.length,a=function(){if(2*i.length>=n.bufferSizeFrequency||window.clickLastSyncTime+n.timeFrequency<=Date.now()&&s>0){var a,c,u=o.slice(0,s),d=Re()||{},l=Pe()||{},f=fe("zId"),p=null!=(a=l.zExternalUserInfo)&&a.externalId?null==(c=l.zExternalUserInfo)?void 0:c.externalId:"",g=/\((.*)\)/.exec((new Date).toString())[1],v=Te(),y={key:e,sdk_ver:b.sdkVersion,src:"Frontend",s_id:d.sessionId,euz_id:f,eue_id:p,events:u,eu_info_id:l.euId,rel_ver:window.zRelVer,handshake_status:window.iszHandshakeDone,ip:n.ip,deviceName:(w=window.navigator.userAgent,(/Mobi|Android/i.test(w)?"Mobile":/Tablet|iPad/i.test(w)?"Tablet":"Web")||""),userAgent:window.navigator.userAgent,timeZone:g,eventType:r.Click,pack:v},m=n.heatMapUrl+"/heatmap";return window.isDataSyncInProgress=!0,Ce()?Promise.resolve(Se(m,y,n.failureRetryCount)).then(function(e){if(e)return window.clickLastSyncTime=Date.now(),function(e){window.zClickEventsData&&Array.isArray(window.zClickEventsData)?window.zClickEventsData.splice(0,e):window.zClickEventsData=[]}(s),window.isDataSyncInProgress=!1,t=!0}):(t=1,!1)}var w}();return Promise.resolve(a&&a.then?a.then(function(e){return!t||e}):!t||a)}catch(e){return Promise.reject(e)}},Ze=function(e){try{var t,n=j();U("Data Length for direct streaming ");var r=window.zEventsPerfData||[],o=r.length,i=function(){if(2*r.length>=n.perfBufferSizeFrequency||window.perfLastSyncTime+n.perfTimeFrequency<=Date.now()&&o>0){var i,s,a=r.slice(0,o),c=Re()||{},u=Pe()||{},d=fe("zId"),l=null!=(i=u.zExternalUserInfo)&&i.externalId?null==(s=u.zExternalUserInfo)?void 0:s.externalId:"",f=/\((.*)\)/.exec((new Date).toString())[1],p={key:e,sdk_ver:b.sdkVersion,src:"Frontend",s_id:c.sessionId,euz_id:d,eue_id:l,events:a,eu_info_id:u.euId,rel_ver:window.zRelVer,handshake_status:window.iszHandshakeDone,ip:n.ip,deviceName:"",screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,userAgent:window.navigator.userAgent,timeZone:f},g=n.perfUrl+"/perf";return window.isDataSyncInProgress=!0,Ce()?Promise.resolve(ze(g,p,n.failureRetryCount)).then(function(e){if(e)return window.perfLastSyncTime=Date.now(),n=o,window.zEventsPerfData&&Array.isArray(window.zEventsPerfData)?window.zEventsPerfData.splice(0,n):window.zEventsPerfData=[],window.isDataSyncInProgress=!1,t=!0;var n}):(t=1,!1)}}();return Promise.resolve(i&&i.then?i.then(function(e){return!t||e}):!t||i)}catch(e){return Promise.reject(e)}},je=function(e){try{var t,n=j(),r=window.zEventsData||[];U("Data Length for direct streaming ");var o="";try{o=JSON.stringify(r)}catch(e){x("Failed to stringify zEvents")}var i=null!=n&&n.eventCountCapInSingleChunk?n.eventCountCapInSingleChunk:0,s=i>0&&r.length>i?i:r.length;T("Going to send data with chunk "+s+" total events count "+r.length+" chunk size "+i);var a=function(){if(2*o.length>=n.bufferSizeFrequency||window.lastSyncTime+n.timeFrequency<=Date.now()&&s>0){var i,a,c=r.slice(0,s),u=Re()||{},d=Pe()||{},l=fe("zId"),f=null!=(i=d.zExternalUserInfo)&&i.externalId?null==(a=d.zExternalUserInfo)?void 0:a.externalId:"",p=/\((.*)\)/.exec((new Date).toString())[1],g=Te(),v={key:e,sdk_ver:b.sdkVersion,src:"Frontend",s_id:u.sessionId,euz_id:l,eue_id:f,events:c,eu_info_id:d.euId,rel_ver:window.zRelVer,handshake_status:window.iszHandshakeDone,ip:n.ip,deviceName:"",screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,userAgent:window.navigator.userAgent,timeZone:p,pack:g},y="";try{y=JSON.stringify(v)}catch(e){x("Failed to stringify zipyDataJson")}var m={eventData:y};return Promise.resolve(function(e){try{Ce()&&"false"===fe("is-api-key-valid")&&Ne(!1);var t=function(){if("isActive"in(t=Re()||{})&&!t.isActive&&Ce())return T("Going to register new session"),Promise.resolve(function(e){try{var t={v:b.sdkVersion},n=Re(),r={enduser_session_id:n.sessionId,user_agent:window.navigator.userAgent,ip_address:"",location:"",enduser_zipy_id:"",project_release_version:"",sdk_version:"",device_name:"",screen_width:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screen_height:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};return Promise.resolve(Ee(b.registerSessionUrl+"/"+e,b.streamMgrRetryCount,t,r)).then(function(t){return t?(function(){var e=Re();if(!e)return!1;try{return T("Setting session as active"+JSON.stringify(e)),e.isActive=!0,pe("session-data",JSON.stringify(e)),!0}catch(e){return x("Failed to stringify  session data"),!1}}(),Xe(t,e),!0):(x("Not able to register new session for session Id : "+n.sessionId),!1)})}catch(e){return Promise.reject(e)}}(e)).then(function(){});var t}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(e)).then(function(){if(Ye())return function(){for(;window.zEventsData.length;)window.zEventsData.pop();window.zEventsData=[]}(),t=!0;var e={session_id:u.dSession,event_id:"AruZ~Em0WNlAnbyzVmwM~GR0cMb6Xl9r",is_new_party:u.isNewSession,is_new_session:u.isNewSession,client_timestamp_iso:(new Date).toISOString(),event_type:"MyEventRecord",parameters:m},r=n.streamUrl+"?p="+u.dSession;return window.isDataSyncInProgress=!0,Ce()?Promise.resolve(Ie({divolteUrl:r,divolteJson:e,failureRetryCount:n.failureRetryCount})).then(function(e){if(e){if(window.lastSyncTime=Date.now(),function(e){window.zEventsData&&Array.isArray(window.zEventsData)?window.zEventsData.splice(0,e):window.zEventsData=[]}(s),window.isDataSyncInProgress=!1,pe("last-activity-time",window.zlastActivityTime),pe("zenduser-last-activity-time",window.zenduserLastActivityTime),u.isNewSession){var n=Re();if(n){n.isNewSession=!1;try{pe("session-data",JSON.stringify(n))}catch(e){x("Failed to set session-data in localstorage")}}}return t=!0}}):(pe("last-activity-time",window.zlastActivityTime),pe("zenduser-last-activity-time",window.zenduserLastActivityTime),window.isDataSyncInProgress=!1,t=1,!1)})}}();return Promise.resolve(a&&a.then?a.then(function(e){return!t||e}):!t||a)}catch(e){return Promise.reject(e)}};function He(o,u){void 0===o&&(o=J.inputMasking),U("Going to init rrweb Recorder"),window.zrrwebRecorderStatus=p.RECORDINGPENDING;var d,l=function(){};try{var f=j();l=e({emit:function(e,o){if(!te()){var u=-1;e.type!=t.IncrementalSnapshot?u=c.ReplayerEvent:(u=e.data.source?e.data.source:c.ReplayerEvent,(f.startCaptureWithoutUserActivity||u>=c.MouseInteraction&&u<=c.MediaInteraction)&&(window.zrrwebRecorderStatus=p.RECORDINGSUCCESSFUL,window.zenduserLastActivityTime=Date.now()));try{var d=!1;window.reinitializationInProgress||(d=Te());var l={data:d?n(e):JSON.stringify(e),time:e.timestamp,type:u,isError:!1,navigatedUrl:window.location.origin+window.location.pathname};if(o&&e.type==t.Meta?(D("Checkout flow is triggered. Meta event expected type - "+t.Meta+" actual event "+e.type),l.isCheckout=o):o&&D("Full snapshot event. Expected event type - "+t.FullSnapshot+" Event type "+e.type),Ke(l),t.IncrementalSnapshot&&u===c.MouseInteraction){var g=e.data;if(g.type&&g.type===r.Click){var v=function(e){T("Heatmap: Pack event");try{var t=JSON.stringify(e),n=i(t),r=s(n);return a(r,!0)}catch(e){return T("Heatmap: Unable to pack the data"),""}}(g);!function(e){var t=j();window.zrecordingPaused||Ye()&&!be(t)||Ce()&&t.captureClickEvents&&window.zClickEventsData.push(e)}({data:v,time:e.timestamp,type:g.type,isError:!1})}}}catch(e){x("Failed to store rrweb recorder events")}}},recordCanvas:H("canvasCapture"),blockClass:(d=H("blockClasses"),d&&"string"==typeof d?new RegExp(d):d instanceof RegExp?d:/zipy-block/),ignoreClass:"zipy-ignore",maskAllInputs:o,sampling:{mousemove:150,scroll:150,mouseInteraction:{MouseUp:!0,MouseDown:!0,Click:!0,ContextMenu:!1,DblClick:!0,Focus:!1,Blur:!1,TouchStart:!0,TouchEnd:!0}},userTriggeredOnInput:!0,recordCrossOriginIframes:H("recordCrossOriginIframes")||J.recordCrossOriginIframes})}catch(e){x(e)}return l}function We(e){return U("Going to init zipy Recorder"),function(e){void 0===e&&(e={});var t=e.emit;if(!t)return x("emit function is required to record data from zipy-event-recorder"),function(){};ie=function(e){t(e)};try{var n=[];n.push(function(e){var t=location.href,n={navigatedUrl:window.location.href};e(Z({eventType:c.NAVIGATION,data:n,isError:!1}));var r=window.history.pushState,o=window.history.replaceState;function i(){try{var n={navigatedUrl:window.location.href};t!=n.navigatedUrl&&(e(Z({eventType:c.NAVIGATION,data:n,isError:!1})),t=n.navigatedUrl)}catch(e){x("not able to capture the navigation url")}}return window.history.pushState=function(){r.apply(window.history,arguments),window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange"))},window.history.replaceState=function(){o.apply(window.history,arguments),window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange"))},window.addEventListener("locationchange",i,!1),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),function(){history.pushState=r,history.replaceState=o,window.removeEventListener("locationchange",i),window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}}(ie));var r=j();return T("In zipy-event-record "+JSON.stringify(r)),r.consoleCapture&&n.push(function(e){function t(e){var t="";if("string"!=typeof e)try{t=JSON.stringify(e)}catch(e){}else t=e;try{if(-1!=t.search(g)||-1!=t.search(v))return!0}catch(e){return!0}return!1}function n(t,n){try{var r;r=function(e){if(!Array.isArray(e))return"";for(var t,n=[],r=F(e);!(t=r()).done;){var o=t.value;try{o&&"object"==typeof o?o.constructor.name.toLowerCase().includes("error")?n.push(String(o)):n.push(JSON.stringify(o)):n.push(String(o))}catch(e){n.push("[console log value cannot be serialized]")}}return n.join(" ")}(Array.from(n));var o=t==c.ConsoleError,i=o?function(e){if(!Array.isArray(e))return{hasErrorObj:!1};for(var t,n=F(e);!(t=n()).done;){var r=t.value;try{if(r&&"object"==typeof r&&r.constructor.name.toLowerCase().includes("error"))return{hasErrorObj:!0,errObj:r}}catch(e){x("Error in checking error argument. Error is - "+e.message)}}return{hasErrorObj:!1}}(Array.from(n)):{hasErrorObj:!1};if(function(e,t){if(null==e)return!1;var n,r=e.toLowerCase(),o=j();try{n=t?o.isIgnoreConsoleError:o.ignoreConsole}catch(e){x(e)}try{if(n.some(function(e){return r.includes(e.toLowerCase())}))return!0}catch(e){return!1}return!1}(r,o))return;if(o&&i.hasErrorObj){var s={message:r,error:i.errObj.stack,filename:"",colno:0,lineno:0};e(Z({eventType:re(r,c.Error),data:s,isError:!0}))}else e(Z({eventType:t,data:{arguments:r,argumentsObj:X(Array.from(n))},isError:o}))}catch(e){return void x("Error in parsing console log. Error is: "+e.message)}}try{var r,o,i,s,a;a=j().consoleLogLevel.split(",");try{a.includes(y.ERROR)&&(r=console.error.bind(console),console.error=function(){t(arguments[0])||n(c.ConsoleError,arguments),r.apply(console,arguments)})}catch(e){x("Error in parsing console error. Error is: "+e.message)}try{a.includes(y.LOG)&&(o=console.log.bind(console),console.log=function(){t(arguments[0])||n(c.ConsoleInfo,arguments),o.apply(console,arguments)})}catch(e){x("Error in parsing console log. Error is: "+e.message)}try{a.includes(y.WARNING)&&(i=console.warn.bind(console),console.warn=function(){t(arguments[0])||n(c.ConsoleWarning,arguments),i.apply(console,arguments)})}catch(e){x("Error in parsing console warning. Error is: "+e.message)}try{a.includes(y.DEBUG)&&(s=console.debug.bind(console),console.debug=function(){t(arguments[0])||n(c.ConsoleDebug,arguments),s.apply(console,arguments)})}catch(e){x("Error in parsing console debug. Error is: "+e.message)}return function(){r&&(console.error=r),o&&(console.log=o),i&&(console.warn=i),s&&(console.debug=s)}}catch(e){return x("Error while getting console log level from sdk config. Error is: "+e.message),function(){}}}(ie)),r.stackTraceCapture&&n.push(function(e){var t=[q("error",function(t){!function(e,t){var n=e.message,r=e.filename,o=e.lineno,i=e.colno;if(ee(n)||ee(r))U("Ignoring error from error callback "+n);else if(e.error){var s,a,u;if(ee(null==(s=e.error)?void 0:s.stack))return void U("Ignoring error from error callback "+(null==(u=e.error)?void 0:u.stack));var d,l=null==(a=e.error)?void 0:a.stack;try{d="string"!=typeof l?JSON.stringify(l):l}catch(e){x("Failed to stringfy errorMsg inside error callback with exception"+e)}var f={message:n,filename:r,lineno:o,colno:i,error:d};t(Z({eventType:re(n,c.Error),data:f,isError:!0}))}else{if((null==n||""==n)&&b.ignoreEmptyErros)return void U("Ignored empty error");var p={message:n,filename:r,lineno:o,colno:i,error:""};t(Z({eventType:re(n,c.Error),data:p,isError:!0}))}}(t,e)},window)];return t.push(q("unhandledrejection",function(t){var n,r="reason"in t?null==t?void 0:t.reason:t,o=null!=t&&t.reason.stack?t.reason.stack:t;try{n="string"!=typeof o?JSON.stringify(o):o}catch(t){x("Failed to stringfy errorMsg inside unhandledrejection callback with exception"+t)}var i={message:""+r,error:n,filename:"",colno:0,lineno:0};if(null!=r&&""!=r||""!=i.error&&null!=i.error||!b.ignoreEmptyErros){var s="";try{s=JSON.stringify(i.error)}catch(t){x("Failed to stringfy exception")}ee(i.message)||ee(s)?U("Ignoring error from unhandled "+r):e(Z({eventType:re(r,c.UnhandledRejection),data:i,isError:!0}))}else U("Ignoring empty errors")},window)),function(){t.forEach(function(e){return e()})}}(ie)),r.networkCapture&&(n.push(function(e){function t(e,t){if(H("networkCapture")&&!window.stopRecording&&!ae(t.requestUrl,t.status,t.status>=400)){t.requestUrl=function(e){try{var t=new URL(e);if(e){var n=new URLSearchParams(new URL(e).search);n.forEach(function(e,t){Y.includes(t.toLowerCase())&&n.set(t,"xxx")}),t.search=n.toString()}return t.toString()}catch(t){return x("updateQueryStringFromRequestUrl: ERROR WHILE HIDING QUERY PARAM VALUE: "+t),e}}(t.requestUrl);var n=j();if(n&&n.isApiIdentifierEnable&&n.apiUniqueIdentifier.length>0){var r=n.apiUniqueIdentifier.filter(function(e){return e.apiUrl===t.requestUrl});r.length>0&&(t.apiIdentifier=function(e,t){try{var n=JSON.parse(e);if(n&&"object"==typeof n)for(var r=Object.keys(n),o=0,i=r;o<i.length;o++){var s=i[o];if(s===t)return"string"==typeof n[s]?n[s]:""}}catch(e){x("error while parsing api payload: "+e)}return""}(t.request,r[0].identifierName))}t=Q(t,0,t.requestByteSize||0,!0),T("Pushing fetch Data when performance is enabled "+(t=Q(t,0,t.responseByteSize||0,!1)).requestUrl),window.zFetchTempData.push({eventType:e,data:t,isError:t.status>=400})}}function n(e,t){if("GET"==t||"get"==t)try{var n=e.split("/"),r=n[n.length-1];if(""==r&&n.length>=2&&(r=n[n.length-2]),-1!=r.indexOf(".js")&&!r.indexOf(".json")||-1!=r.indexOf(".map")||-1!=r.indexOf(".html")||-1!=r.indexOf(".css"))return T("Going to ignore response text for url "+e),!0}catch(e){return!1}return!1}if(null!=window.zxhrInit||1==window.zxhrInit)return T("Network in already initialized"),function(){};var r=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var e="";null!=arguments[1]&&null!=arguments[1]&&("string"==typeof arguments[1]?e=arguments[1]:arguments[1]instanceof URL&&(e=arguments[1].href));var o,i,s={request:"",requestMethod:arguments[0]?arguments[0]:"",requestUrl:e,sourceLibrary:"xmlHttpClient",headers:{},response:"",responseHeaders:{},status:400,requestStartTime:0,duration:0,requestByteSize:0,responseByteSize:0},a=this.send;this.send=function(){s.requestStartTime=Date.now(),s.request=arguments[0]?arguments[0]:"",s=Q(s,0,0,!0),a.apply(this,arguments)};var u=this.setRequestHeader;this.setRequestHeader=function(){var e,t;2!==arguments.length||(e=arguments[0],(t=V()).length>0&&t.indexOf(e)>-1)||(s.headers[arguments[0]]=arguments[1]),u.apply(this,arguments)},this.addEventListener("load",function(){try{var r=function(){s.status=a.status,s.duration=o-s.requestStartTime,t(c.XHR,s)},a=this;o=Date.now();var u=function(){if(!n(e,s.requestMethod)){var t=function(e,t){try{var n=function(){function e(){s.responseByteSize=n,s.response=i,s=Q(s,0,n,!1)}var t=a.getAllResponseHeaders().split("\n"),n=0;t.forEach(function(e){if(""!==e){var t=e.split(":");s.responseHeaders[t[0]]=t[1].trim(),!n&&t[0]&&"content-length"==t[0].toLowerCase()&&(n=t[1].trim())}});var r=function(){var e;if("blob"===(null==a?void 0:a.responseType))return n=n||(null==a||null==(e=a.response)?void 0:e.size),Promise.resolve(new Response(null==a?void 0:a.response).text()).then(function(e){i=e});i=null!=a&&a.responseText?a.responseText:"",n=n||i.length}();return r&&r.then?r.then(e):e()}()}catch(e){return t()}return n&&n.then?n.then(void 0,t):n}(0,function(){U("Error while capturing response text")});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(u&&u.then?u.then(r):r())}catch(e){return Promise.reject(e)}}),this.addEventListener("error",function(){try{o=Date.now();var e=this.getAllResponseHeaders().split("\n"),n=0;e.forEach(function(e){if(""!==e){var t=e.split(":");s.responseHeaders[t[0]]=t[1].trim(),!n&&t[0]&&"content-length"==t[0].toLowerCase()&&(n=t[1].trim())}});var r=H("responseCapSize")||1e6,i=H("sizeExceededMessage");(n=n||(null==this?void 0:this.responseText.length))&&n<=r?s.response=null!=this&&this.responseText?this.responseText:"":n>0&&(s.response=i),s.responseByteSize=n||0}catch(e){U("Error while capturing response text")}s.status=this.status?this.status:404,t(c.XHR,s)}),this.addEventListener("abort",function(){T("Request got aborted in fetch")}),r.apply(this,arguments)};var o=window.fetch;return window.fetch=function(){var e,r,i,s,a="",u={sourceLibrary:"fetch",requestUrl:"",requestMethod:"",headers:"",request:"",response:"",responseHeaders:{},status:400,requestStartTime:0,duration:0,requestByteSize:0,responseByteSize:0};u.requestStartTime=Date.now(),null!=arguments[0]&&null!=arguments[0]&&(a="string"==typeof(e=arguments[0])?e:e?e instanceof URL?e.href:e instanceof Request?e.url:"":"");try{if(null!=arguments[1]&&null!=arguments[1]){var d=arguments[1].body;d&&(u.requestByteSize=JSON.stringify(d,null,4).length)}}catch(e){x("error while capturing data length")}try{arguments[1]&&arguments[1].headers&&(r=P({},arguments[1].headers))}catch(e){x("header is not present in the call")}u=Q(u={sourceLibrary:"fetch",requestUrl:a||"",requestMethod:arguments[1]&&arguments[1].method?arguments[1].method:"GET",headers:r?(i=r,s=V(),s.length>0?(s.forEach(function(e){return delete i[e]}),i):i):"",request:arguments[1]&&arguments[1].body?arguments[1].body:"",response:"",responseHeaders:{},status:400,duration:0,requestByteSize:0,responseByteSize:0,requestStartTime:u.requestStartTime},0,0,!0);var l=o.apply(window,arguments);return new Promise(function(e,r){var o={status:400},i=0;l.then(function(t){o={status:t.status};for(var n,r=F(t.headers);!(n=r()).done;){var s=n.value;s&&(u.responseHeaders[s[0]]=s[1],!i&&s[0]&&"content-length"==s[0].toLowerCase()&&(i=s[1]))}return e(t.clone()),ne(t)}).then(function(e){var r=Date.now(),s=H("xhrRespPayloadCapture");(!n(a,u.requestMethod)&&o.status>=400||s)&&(u.response=e,u=Q(u,0,i,!1)),u.duration=r-u.requestStartTime,u.status=o.status,t(c.XHR,u)}).catch(function(e){x("Error in fetch response: "+e.message),r(e)})})},window.zxhrInit=!0,function(){}}()),n.push(function(e){var t=[q("online",function(t){de(e)},window)];return t.push(q("offline",function(t){de(e)},window)),function(){t.forEach(function(e){return e()})}}(ie))),n.push(function(e){var t=[];return t.push(q(E,function(t){try{var n=null==t?void 0:t.detail,r=n.message,o=n.options,i=void 0===o?{}:o;U("Capturing log message for message : "+r+" options: "+JSON.stringify(i)),r&&i&&i.constructor===Object?e(Z({eventType:c.ZipyLogMessage,data:{message:r.length<I?r:r.substring(0,I),options:i},isError:!1})):T("Didn't capture log message for message : "+r+" options: "+JSON.stringify(i))}catch(e){x("Error in capturing log message. Error is - "+e.message)}},window)),t.push(q(S,function(t){try{var n,r=(null==(n=t.detail)?void 0:n.error)||{},o=r.message,i=r.name,s=void 0===i?"":i,a=r.filename,u=void 0===a?"":a,d=r.lineno,l=void 0===d?0:d,f=r.colno,p=void 0===f?0:f,g=r.cause,v=void 0===g?"":g,y=r.stack,m=void 0===y?"":y;if(v=v?String(v):"",U("Capturing exception message for message : "+o+" name: "+s+" stack: "+m),ee(o)||ee(s))return void U("Ignoring exception logs for message: "+o);o?e(Z({eventType:c.ZipyLogException,data:{message:o,name:s,filename:u,lineno:l,colno:p,cause:v,stack:m},isError:!0})):T("Didn't capture exception message for message : "+o+" name: "+s)}catch(e){x("Error in capturing log message. Error is - "+e.message)}},window)),t.push(q(z,function(t){try{var n=null==t?void 0:t.detail,r=n.name,o=n.message,i=void 0===o?"":o,s=n.category,a=void 0===s?"FE":s,u=n.options,d=void 0===u?{}:u;if(U("Capturing exception message for message : "+i+" name: "+r),ee(i)||ee(r))return void U("Ignoring error logs for message: "+i);i&&r&&d&&d.constructor===Object?e(Z({eventType:"NE"===a?c.ZipyLogNetworkError:c.ZipyLogFrontendError,data:{message:i.length<I?i:i.substring(0,I),name:r,category:a,options:d},isError:!0})):T("Didn't capture error message for message : "+i+" name: "+r+" category:"+a+" options: "+JSON.stringify(d))}catch(e){x("Error in capturing log message. Error is - "+e.message)}},window)),function(){t.forEach(function(e){return e()})}}(ie)),n.push(function(e){if(window.PerformanceObserver&&"function"==typeof window.PerformanceObserver){var t=new PerformanceObserver(function(t){var n=t.getEntries();T("perf event size is - "+n.length),x("Perf entires"),x(n.filter(function(e){return"fetch"==e.initiatorType||"xmlhttprequest"==e.initiatorType}));for(var r,o=F(n);!(r=o()).done;){var i=r.value;try{var s=oe(i.initiatorType);if(s===c.XHR&&window.zFetchTempData&&window.zFetchTempData.length>0)for(var a=[].concat(window.zFetchTempData)||[],u=function(t){var n;x("Compare tempData[j].data?.requestUrl {} and entries[i].name"),T("Merging XHR calls");var r=(null==(n=a[t].data)?void 0:n.requestUrl)||"",o=i.name||"";if(o&&r&&decodeURIComponent(r)===decodeURIComponent(o)||ue(r,o)){var s,u,d,l;T("INSIDE :: Compare xhrUrl "+r+" and perfURL "+o);var f=ce(i);f.responseStatus=i.responseStatus?i.responseStatus:null==(s=a[t].data)?void 0:s.status,f.transferSize=i.transferSize?i.transferSize:null==(u=a[t].data)?void 0:u.responseByteSize,f.apiIdentifier=(null==(d=a[t].data)?void 0:d.apiIdentifier)||"",r.indexOf("http://")>-1||r.indexOf("https://")>-1||(a[t].data.requestUrl=o);var p=P({},a[t].data,f);return a[t]=P({},a[t],{data:p}),T("Merged XHR calls is "+a[t]),e(Z({eventType:c.Performance,data:P({},f,{method:null==(l=a[t].data)?void 0:l.requestMethod}),isError:f.responseStatus>=400})),e(Z(a[t])),T("Old temp XHR data calls length "+window.zFetchTempData.length),window.zFetchTempData=window.zFetchTempData.filter(function(e,n){return n!=t}),T("New temp XHR data calls length "+window.zFetchTempData.length),1}},d=0;d<a.length&&!u(d);d++);else if(s&&s!=c.XHR){var l=ce(i),f=l.responseStatus>=400;ae(i.name,i.responseStatus,f)||e(Z({eventType:c.Performance,data:P({},l,{method:"GET"}),isError:f}))}else x("XHR request but zFetchTempData is empty. API: "+i.name+", Event type: "+s+". Initiator type - "+i.initiatorType)}catch(e){x("Error in capturing perf data. Error is - "+e.message)}}});return t.observe({entryTypes:["resource"]}),function(){return t.disconnect()}}return function(){}}(ie)),n.push(function(e){var t=performance.getEntriesByType("resource").filter(function(e){return se.indexOf(e.initiatorType)>-1});U("Inside initial perf event function. Size of data is - "+t.length);for(var n,r=F(t);!(n=r()).done;){var o=n.value;if(!ae(o.name,o.responseStatus,o.responseStatus>=400)){var i=ce(o);e(Z({eventType:c.Performance,data:P({},i,{method:"GET"}),isError:(null==i?void 0:i.responseStatus)>=400}))}}return function(){}}(ie)),r.webSocketsCapture&&(D("Going to init websockets",window),window.sdkInit?function(){if(D("Start recording"),window._websockets&&window._websockets.length)for(var e=0;e<window._websockets.length;e++)window._websockets[e]&&window._websockets[e].zRecordStart&&"function"==typeof window._websockets[e].zRecordStart&&(window._websockets[e].zRecordStart(),D("Zipy Recording Status:"))}():function(e){function t(t,n){window.stopRecording||e(Z({eventType:t,data:n,isError:t==c.WSERROR}))}function n(e){D("onmessage: ");var n={data:e.data,type:e.type,wsTimestamp:e.timeStamp},r={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:u.MESSAGERECEIVED};r.responseData=n,t(c.WSMESSAGE,r)}function r(e){D("onclose: ");var n=window._websockets.indexOf(this.ws);n>-1&&window._websockets.splice(n,1);var r={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:u.SOCKETCLOSE};r.responseData={code:e.code,reason:e.reason,type:e.type,wsTimestamp:e.timeStamp},t(c.WSCLOSE,r)}function o(e){D("onopen: ");var n={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:u.SOCKETERROR};t(c.WSOPEN,n)}function i(e){D("onerror: ");var n={requestUrl:this.url?this.url:"",responseData:{},status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,timestamp:Date.now(),wsMsgType:u.SOCKETERROR};n.responseData={code:e.code,reason:e.reason,type:e.type,wsTimestamp:e.timeStamp},t(c.WSERROR,n)}D("Inside captureWebSocketRequest"),D("Going to call WebSocket connection");var s=new Proxy(window.WebSocket,{construct:function(e,s){D("WebSocket connection");var a=L(e,s),d=n,l=r,f=o,p=i,g=a.send;return a.zRecordStatus="initiated",a.zRecordStart=function(){"started"!==a.zRecordStatus&&(function(e){var n=e.send;e.send=function(e){D("onsend");var r={requestUrl:this.url?this.url:"",status:"",protocols:this.protocol,extension:"string"==typeof this.extensions?[this.extensions]:this.extensions,readyState:this.readyState,requestData:arguments[0]?arguments[0]:"",timestamp:Date.now(),wsMsgType:u.MESSAGESEND};n.apply(this,[e]),t(c.WSMESSAGE,r)}}(a),a.addEventListener("message",d),a.addEventListener("open",f),a.addEventListener("error",p),a.addEventListener("close",l),a.zRecordStatus="started")},a.zRecordStop=function(){"stopped"!==a.zRecordStatus&&(a.send=g,a.removeEventListener("message",d),a.removeEventListener("open",f),a.removeEventListener("error",p),a.removeEventListener("close",l),a.zRecordStatus="stopped")},window._websockets=window._websockets||[],window._websockets.push(a),window.stopRecording||a.zRecordStart(),a}});D("Going to set WebSocket connection"),window.WebSocket=s}(ie)),function(){n.forEach(function(e){return e()}),function(){if(D("Stop recording"),window._websockets&&window._websockets.length)for(var e=0;e<window._websockets.length;e++)window._websockets[e]&&window._websockets[e].zRecordStop&&"function"==typeof window._websockets[e].zRecordStop&&(window._websockets[e].zRecordStop(),D("Zipy Recording Status:"))}()}}catch(e){return x(e),function(){}}}({emit:function(e){try{var t=j();if(e.eventType!=c.Online||window.iszHandshakeDone||(window.ztryForHandshake=!0),window.iszSessionExpired)return void U("Don't store zipy events if session is expired");(t.startCaptureWithoutUserActivity||e.eventType>=c.Error&&e.eventType<=c.UnhandledRejection)&&(window.zrrwebRecorderStatus=p.RECORDINGSUCCESSFUL);var n,r={data:JSON.stringify(e.data),time:e.timestamp,type:e.eventType===c.Performance?oe(e.data.initiatorType):e.eventType,isError:e.isError,navigatedUrl:window.location.origin+window.location.pathname};r.type===c.XHR&&e.eventType==c.Performance||Ke(r),t.capturePerformance&&c.Performance===e.eventType&&function(e){var t=j();window.zrecordingPaused||Ye()&&!be(t)||Ce()&&window.zEventsPerfData.push(e)}({data:e.data,type:null==(n=e.data)?void 0:n.initiatorType,time:e.timestamp})}catch(e){x("Failed to store events")}}})}function Ke(e){var t=j();window.zrecordingPaused||Ye()&&!be(t)||Ce()&&window.zEventsData.push(e),window.zlastActivityTime=Date.now()}var Ve=function(e){var t,n,r={domCapture:"boolean"==typeof(null==e?void 0:e.dom_capture)?null==e?void 0:e.dom_capture:J.domCapture,consoleCapture:"boolean"==typeof(null==e?void 0:e.console_capture)?null==e?void 0:e.console_capture:J.consoleCapture,networkCapture:"boolean"==typeof(null==e?void 0:e.network_capture)?null==e?void 0:e.network_capture:J.networkCapture,stackTraceCapture:"boolean"==typeof(null==e?void 0:e.stack_trace_capture)?null==e?void 0:e.stack_trace_capture:J.stackTraceCapture,webSocketsCapture:"boolean"==typeof(null==e?void 0:e.web_sockets_capture)?null==e?void 0:e.web_sockets_capture:J.webSocketsCapture,ipCapture:"boolean"==typeof(null==e?void 0:e.ip_capture)?null==e?void 0:e.ip_capture:J.ipCapture,inputMasking:"boolean"==typeof(null==e?void 0:e.input_masking)?null==e?void 0:e.input_masking:J.inputMasking,textMasking:"boolean"==typeof(null==e?void 0:e.text_masking)?null==e?void 0:e.text_masking:J.textMasking,paid:"boolean"==typeof(null==e?void 0:e.paid)?null==e?void 0:e.paid:J.paid,apiKey:null==e?void 0:e.api_key,streamUrl:null!=e&&e.stream_url?null==e?void 0:e.stream_url:J.streamUrl,maxBufferSize:null!=e&&e.max_buffer_size?1024*(null==e?void 0:e.max_buffer_size):J.maxBufferSize,compression:"boolean"==typeof(null==e?void 0:e.compression)?null==e?void 0:e.compression:J.compression,compressionType:null!=e&&e.compression_type?null==e?void 0:e.compression_type:J.compressionType,timeFrequency:null!=e&&e.time_frequency?1e3*(null==e?void 0:e.time_frequency):J.timeFrequency,encodingType:null==e?void 0:e.encoding_type,sessionTimeout:null!=e&&e.session_timeout?1e3*(null==e?void 0:e.session_timeout):J.sessionTimeout,failureRetryCount:null!=e&&e.failure_retry_count?null==e?void 0:e.failure_retry_count:J.failureRetryCount,bufferSizeFrequency:null!=e&&e.buffer_size_frequency?1024*(null==e?void 0:e.buffer_size_frequency):J.bufferSizeFrequency,ignoreUrl:null!=e&&e.ignoreUrl?null==e?void 0:e.ignoreUrl:J.ignoreUrl,ignoreError:null!=e&&e.ignoreError?null==e?void 0:e.ignoreError:J.ignoreError,ignoreConsole:null!=e&&e.ignoreConsole?null==e?void 0:e.ignoreConsole:J.ignoreConsole,isIgnoreUrlError:null!=e&&e.isIgnoreUrlError?null==e?void 0:e.isIgnoreUrlError:J.isIgnoreUrlError,isIgnoreConsoleError:null!=e&&e.isIgnoreConsoleError?null==e?void 0:e.isIgnoreConsoleError:J.isIgnoreConsoleError,ip:null!=e&&e.ip?null==e?void 0:e.ip:"",pack:!(null==e||!e.pack||!e.pack),blockClasses:(t=null!=e&&e.blockClasses?null==e?void 0:e.blockClasses:J.blockClasses,n="zipy-block",t=(t=t&&t.length?t+(n?","+n:""):n).split(",").filter(W).map(K).join("|"),new RegExp(t)),customerId:null==e?void 0:e.cId,headersToSanitize:null!=e&&e.headersToSanitize?e.headersToSanitize:"",xhrReqPayloadCapture:"boolean"==typeof(null==e?void 0:e.xhrReqPayloadCap)?null==e?void 0:e.xhrReqPayloadCap:J.xhrReqPayloadCapture,xhrRespPayloadCapture:"boolean"==typeof(null==e?void 0:e.xhrRespPayloadCap)?null==e?void 0:e.xhrRespPayloadCap:J.xhrRespPayloadCapture,canvasCapture:"boolean"==typeof(null==e?void 0:e.canvasCapture)?null==e?void 0:e.canvasCapture:J.canvasCapture,requestCapSize:null!=e&&e.requestCapSize?null==e?void 0:e.requestCapSize:J.requestCapSize,responseCapSize:null!=e&&e.responseCapSize?null==e?void 0:e.responseCapSize:J.responseCapSize,sizeExceededMessage:null!=e&&e.sizeExceededMessage?null==e?void 0:e.sizeExceededMessage:J.sizeExceededMessage,eventCountCapInSingleChunk:"number"==typeof(null==e?void 0:e.eventCountCapInSingleChunk)?e.eventCountCapInSingleChunk:J.eventCountCapInSingleChunk,captureCustomZipyLogMessage:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogMessage)?e.captureCustomZipyLogMessage:J.captureCustomZipyLogMessage,captureCustomZipyLogError:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogError)?e.captureCustomZipyLogError:J.captureCustomZipyLogError,captureCustomZipyLogException:"boolean"==typeof(null==e?void 0:e.captureCustomZipyLogException)?e.captureCustomZipyLogException:J.captureCustomZipyLogException,startCaptureWithoutUserActivity:"boolean"==typeof(null==e?void 0:e.startCaptureWithoutUserActivity)?e.startCaptureWithoutUserActivity:J.startCaptureWithoutUserActivity,consoleLogLevel:null!=e&&e.consoleLogLevel?e.consoleLogLevel:J.consoleLogLevel,recordCrossOriginIframes:J.recordCrossOriginIframes,splitSessionSize:"number"==typeof(null==e?void 0:e.splitSessionSize)?e.splitSessionSize:J.splitSessionSize,capturePerformance:"boolean"==typeof(null==e?void 0:e.capturePerformance)?e.capturePerformance:J.capturePerformance,perfUrl:null!=e&&e.perfUrl?null==e?void 0:e.perfUrl:J.perfUrl,perfTimeFrequency:"number"==typeof(null==e?void 0:e.perfTimeFrequency)?e.perfTimeFrequency:J.perfTimeFrequency,perfBufferSizeFrequency:"number"==typeof(null==e?void 0:e.perfBufferSizeFrequency)?e.perfBufferSizeFrequency:J.perfBufferSizeFrequency,clickTimeFrequency:"number"==typeof(null==e?void 0:e.clickTimeFrequency)?e.clickTimeFrequency:J.clickTimeFrequency,clickBufferSizeFrequency:"number"==typeof(null==e?void 0:e.clickBufferSizeFrequency)?e.clickBufferSizeFrequency:J.clickBufferSizeFrequency,isApiIdentifierEnable:"boolean"==typeof(null==e?void 0:e.isApiIdentifierEnable)?e.isApiIdentifierEnable:J.isApiIdentifierEnable,apiUniqueIdentifier:null!=e&&e.apiUniqueIdentifier&&Array.isArray(e.apiUniqueIdentifier)?e.apiUniqueIdentifier:J.apiUniqueIdentifier,ignoreUrlErrorCodes:null!=e&&e.ignoreUrlErrorCodes?e.ignoreUrlErrorCodes:J.ignoreUrlErrorCodes,ignoreUrlCodes:null!=e&&e.ignoreUrlCodes?e.ignoreUrlCodes:J.ignoreUrlCodes,heatMapUrl:null!=e&&e.heatMapUrl?e.heatMapUrl:J.heatMapUrl,captureClickEvents:"boolean"==typeof(null==e?void 0:e.captureClickEvents)?e.captureClickEvents:J.captureClickEvents,sessionStitching:null!=e&&e.sessionStitching?e.sessionStitching:J.sessionStitching};return r.ignoreUrl.push(r.streamUrl.substring(r.streamUrl.indexOf("://")+3)),r.ignoreUrl.push(r.streamUrl.substring(r.perfUrl.indexOf("://")+3)),r.ignoreUrl.push(r.streamUrl.substring(r.heatMapUrl.indexOf("://")+3)),r.ignoreUrl.push(b.streamMgrUrl.substring(b.streamMgrUrl.indexOf("://")+3)),r.ignoreUrl.push("google.com"),r.isIgnoreUrlError.push(r.streamUrl.substring(r.streamUrl.indexOf("://")+3)),r.isIgnoreUrlError.push(b.streamMgrUrl.substring(b.streamMgrUrl.indexOf("://")+3)),r.isIgnoreUrlError.push("google.com"),function(e){if(e)try{var t;T("Updating zsdk-config"+JSON.stringify(e)),e.blockClasses=null==(t=e.blockClasses)?void 0:t.source,pe("zsdk-config",JSON.stringify(e))}catch(e){x("Failed to stringify zsdk-config ")}}(r),r};function Xe(e,t){var n,r=(null==e?void 0:e.blocked_till)>0?null==e?void 0:e.blocked_till:0,o=r>0?M()+r:0;n={isBlocked:!(null==e||!e.is_blocked)&&(null==e?void 0:e.is_blocked),apiKey:t,blockedEndTime:o},window.zSessionBlockedInfo=n,ye(n)}function Ye(){var e=window.zSessionBlockedInfo||{};return!(null==e||!e.isBlocked)&&e.isBlocked}function $e(e,t){try{for(var n,r=F(window.document.querySelectorAll("iframe"));!(n=r()).done;){var o=n.value;try{var i=new URL(o.src);if(t){if(i.origin!==window.document.location.origin&&o.contentWindow===(null==t?void 0:t.source))return U("sending message to iframe to start recording"),void o.contentWindow.postMessage({action:k,config:e},"*");continue}i.origin!==window.document.location.origin&&(U("sending message to iframe to start recording"),o.contentWindow.postMessage({action:k,config:e},"*"))}catch(e){x("failed to start recording for iframe:")}}}catch(e){x("failed to start recording")}}function Qe(){try{var e=window.document.querySelectorAll("iframe");U("going to stop iframe");for(var t,n=F(e);!(t=n()).done;){var r=t.value;try{new URL(r.src).origin!==window.document.location.origin&&(U("sending message to iframe to stop recording"),r.contentWindow.postMessage({action:C},"*"))}catch(e){x("failed to stop recording for iframe:")}}}catch(e){x("failed to stop recording")}}var et=function(e){try{var t,n,r=document.cookie,o=null==r?void 0:r.split(";"),i=!1;return o.forEach(function(r){var o=r.split("=");if(o[0].trim()===e){var s=o[1].split("%");s.length>1?(n=nt(s),i=!0):t=o[1]?o[1]:""}}),i?n:t}catch(e){return void x("inside zGetCookie catch block")}},tt=function(e,t){var n=new Date((new Date).valueOf()+216e5).toUTCString();document.cookie=e+"="+t+"; path=/; domain="+window.zRootDomain+"; expires="+n+";"},nt=function(e){var t={};return e.forEach(function(e){var n=e.split("#");t[n[0]]=n[1]?n[1]:""}),t||{}},rt=function(e){var t=et(e+w.enduser_last_activity_time),n=et(e+w.total_data_sent)?et(e+w.total_data_sent):"0",r=et(e+w.session_data),o=et(e+w.last_activity_time);try{if(o){(t||r||o)&&(window.iszSessionExpired=!1);var i="0:"+G().replace("-",":");pe("ztotal-data-sent",n),pe("last-activity-time",o),pe("zenduser-last-activity-time",t),window.zenduserLastActivityTime=t,window.zlastActivityTime=o;var s=Pe()||{},a=we()||{},c=Re()||{};s.isBlocked="true"===(null==r?void 0:r.isBlocked),s.euId=Number(null==r?void 0:r.euId),s.zExternalUserInfo.externalId=(null==r?void 0:r.externalId)||"",s.zAnonymsUserInfo.zId=(null==r?void 0:r.zId)||"",a.isBlocked="true"===(null==r?void 0:r.isBlocked),c.dSession=i,c.sessionId=(null==r?void 0:r.sessionId)||"",c.sdkKey=(null==r?void 0:r.sdkKey)||"",c.isActive="true"===(null==r?void 0:r.isActive),pe("zId",(null==r?void 0:r.zId)||""),ye(a),pe("zenduser-info",JSON.stringify(s)),pe("zenduser-info-temp",JSON.stringify(s)),pe("session-data",JSON.stringify(c))}}catch(e){return void x("inside zSetLocalStorageDataFromCookie catch block")}},ot=function(e){var t=function(){try{var e=Pe(),t=we(),n=Re()||{},r=fe("zId"),o=fe("last-activity-time"),i=fe("ztotal-data-sent")?fe("ztotal-data-sent"):"0",s=fe("zenduser-last-activity-time");return{sessionId:null==n?void 0:n.sessionId,zId:r,euId:null==e?void 0:e.euId,isBlocked:null==t?void 0:t.isBlocked,sdkKey:null==n?void 0:n.sdkKey,lastActivityTime:o,totalDataSent:i,endUserLastActivityTime:s,isActive:null==n?void 0:n.isActive,externalId:(null==e?void 0:e.zExternalUserInfo.externalId)||""}}catch(e){return void x("inside zGetCookieDatafromLocalStorage catch block")}}();try{var n="sessionId#"+t.sessionId+"%isActive#"+t.isActive+"%isBlocked#"+t.isBlocked+"%sdkKey#"+e+"%zId#"+t.zId+"%euId#"+Number(t.euId)+"%externalId#"+t.externalId;tt(e+w.session_data,n),tt(e+w.last_activity_time,t.lastActivityTime),tt(e+w.enduser_last_activity_time,t.endUserLastActivityTime),tt(e+w.total_data_sent,t.totalDataSent)}catch(e){return void x("inside zSetCookieDataFromLocalStorage catch block")}},it=function(e){try{var t,n=function(n){if(t)return n;function o(){function t(t){function n(){function t(t){function n(t){t&&U("Successfully sent click data to server via session storage"),lt(b.sdkLoopTime,e)}t&&U("Successfully sent pref data to server via session storage");var o=!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=p.RECORDINGPENDING&&r.captureClickEvents;return o?Promise.resolve(Je(e)).then(n):n(o)}var n=!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=p.RECORDINGPENDING&&r.capturePerformance;return n?Promise.resolve(Ze(e)).then(t):t(n)}var o=function(){if(t){var n=function(){U("Successfully send data to server via session storage")},o=function(){if(window.zrecordingPaused){window.zrecordingPaused=!1,window.reinitializationInProgress=!0;var t=l.GETUSERCONFIG;return Ge()&&(t=l.POSTENDUSERINFOANDGETUSERCONFIG),Promise.resolve(Be(e,t,!1)).then(function(e){r=e,window.zStop=dt()})}}();return o&&o.then?o.then(n):n()}var i=window.zEventsData||[],s="";try{s=JSON.stringify(i)}catch(e){x("Failed stringify events while stream data server")}0!=r.maxBufferSize&&2*s.length>r.maxBufferSize&&!window.zrecordingPaused&&(window.zrecordingPaused=!0,T("Max Buffer size is reached going to pause recording"))}();return o&&o.then?o.then(n):n()}var n=!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=p.RECORDINGPENDING;return n?Promise.resolve(je(e)).then(t):t(n)}var i=function(){if(window.ztryForHandshake)return Promise.resolve(Be(e,window.zpendingOp,!1)).then(function(e){r=e})}();return i&&i.then?i.then(o):o()};if(0==window.sdkInit)return T("Sdk is not initialized yet"),lt(b.sdkLoopTime,e),Promise.resolve();if(window.isDataSyncInProgress)return U("Data sync in in progress"),lt(b.sdkLoopTime,e),Promise.resolve();if(window.reinitializationInProgress)return U("Reinit is in progress"),lt(b.sdkLoopTime,e),Promise.resolve();var r=j(),o=function(){if(be(r)&&window.zEventsData&&window.zEventsData.length>0&&!window.iszInternetDisconnected&&window.zrrwebRecorderStatus!=p.RECORDINGPENDING){T("Session is expired Going to recreate session"),window.reinitializationInProgress=!0,Ue(e);var n=l.GETUSERCONFIG;return Ge()&&(n=l.POSTENDUSERINFOANDGETUSERCONFIG),Promise.resolve(Be(e,n,!0)).then(function(n){r=n,window.zrecordingPaused=!1,window.zStop=dt(),lt(b.sdkLoopTime,e),t=1})}}();return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(e){return Promise.reject(e)}},st=5,at=function(e,t){void 0===t&&(t={releaseVer:"",rootDomain:""});try{return Promise.resolve(function(n,r){try{var o=function(){if(O=b.debugLogs,te()){if(function(){try{return window.top.window.zipy?(U("Zipy is present in parent"),!0):(U("Zipy is not present in parent"),!1)}catch(e){return x("Error in is same origin method. Error - "+(e?e.message:e)),!1}}())return void T("Not initializing sdk as function is called inside iframe.");if(!function(e){var t=null;try{var n,r,o=null==e||null==(n=e.window)||null==(n=n.top)?void 0:n.document;t=null==o||null==(r=o.body)?void 0:r.innerHTML}catch(e){U("iframe is cross-domain")}return null!==t}(window.self)&&J&&J.recordCrossOriginIframes){window.recordingStatus||(window.recordingStatus=!1);try{window.onload=function(){U("Iframe content loaded!"),window.parent.postMessage({action:N},"*")}}catch(e){x("not able to notify about iframe content loaded event:")}var n=e;try{T("init: We will start recording cross-origin iframe now!"),function(e,t){window.addEventListener("message",function(n){try{var r,o;(null==n||null==(r=n.data)?void 0:r.action)===k&&(null==n||null==(o=n.data)||null==(o=o.config)?void 0:o.apiKey)==e&&!0!==window.recordingStatus&&(U("going to init iframe recording"),t.push(He(n.data.config.inputMasking)),window.sdkConfig=n.data.config,window.recordingStatus=!0)}catch(e){x("cannot start recording for iframe:")}try{var i;(null==n||null==(i=n.data)?void 0:i.action)==C&&!1!==window.recordingStatus&&(U("going to stop recording for iframe"),window.stopRecording=!0,t.forEach(function(e){return e()}),window.recordingStatus=!1)}catch(e){x("failed to stop iframe recording:")}})}(n,[])}catch(e){x(e.message)}return}}var r=new RegExp(/^[a-zA-Z0-9]{8}$/);if(e&&r.test(e))return t.rootDomain&&new RegExp(R).test(t.rootDomain)&&(window.zRootDomain=t.rootDomain),window.zRelVer=t.releaseVer,window.zsdkKey=e,function(){try{for(var e=Object.keys(localStorage),t=0;t<e.length;t++)["zsession-blocked-info","session-data","zId","zenduser-info-temp","zenduser-info","last-activity-time","pack","zsdk-config","is-api-key-valid","zenduser-last-activity-time","ztotal-data-sent"].includes(e[t])&&(le.set(e[t],localStorage.getItem(e[t])),T("updated value in map is :"+le.get(e[t])))}catch(e){x("inside zLocalStorgeMapUpdate catch block ${e.message}")}}(),Promise.resolve(function(e){var t=[];try{for(window.sdkInit=!1,window.isDataSyncInProgress=!1,window.zEventsData=[],window.zEventsPerfData=[],window.zFetchTempData=[],window.zClickEventsData=[],window.iszInternetDisconnected=!1,window.zlastActivityTime=Date.now(),window.zenduserLastActivityTime=Oe(),window.zenduserLastActivityTime||(window.zenduserLastActivityTime=Date.now()),window.zrecordingPaused=!1,window.ztryForHandshake=!1,window.iszSessionExpired=!1,window.zrrwebRecorderStatus=p.NORECORDING;window.zEventsData.length;)window.zEventsData.pop();var n=window.sessionStorage.getItem("pending-zEvents");if(T("pendingEvents value is"+n),n)try{var r;r=JSON.parse(n),window.zEventsData=r}catch(e){x("Failed to parse zipyEvents")}var o=we();o&&o.apiKey==e||me(e),U("Zipy Recorder init"),De(e)&&(Pe()?(T("Removing enduser-info"),ge("zenduser-info")):T("zenduser Data dosen't exists"),Fe());var i=l.GETUSERCONFIG;if(!Pe()&&!_e()){i=l.POSTENDUSERINFOANDGETUSERCONFIG;var s=xe(),a={euId:0,euZName:"",userType:f.ANONYMS,isBlocked:!1,zExternalUserInfo:{},zAnonymsUserInfo:{zId:s,euId:0,euZName:""}};Ae(a),Le(a)}Ge()&&(i=l.POSTENDUSERINFOANDGETUSERCONFIG);var c=!1,u=ve()||{};window.zRootDomain&&rt(e),(be(u)||De(e))&&(Ue(e),c=!0),Be(e,i,c).then(function(e){if(window.lastSyncTime=0,window.perfLastSyncTime=0,window.clickLastSyncTime=0,e.domCapture){var n=He(e.inputMasking);t.push(n)}t.push(We());try{window.addEventListener("message",function(t){var n;(null==t||null==(n=t.data)?void 0:n.action)===N&&!0!==window.stopRecording&&$e(e,t)})}catch(e){x("failed to start recording for iframe content loaded event")}$e(e),window.zStop=function(){try{window.stopRecording=!0,t.forEach(function(e){return e()}),D("Calling zipy Stop Recorder"),Qe()}catch(e){x("Failed to stop recording")}},window.sdkInit=!0}).catch(function(e){window.sdkInit=!0,x("Failed to get get sdk config from server: ")})}catch(e){x(e)}return function(){}}(e)).then(function(){lt(b.sdkLoopTime,e),function(e){document.addEventListener("visibilitychange",function(t){if(window.zRootDomain)try{var n=j();document.hidden&&n.sessionStitching?ot(e):rt(e)}catch(e){x("Failed to set CookieData on tab visibility. Error - "+e.message)}if("visible"===document.visibilityState)try{if(be(e)){var r=j();window.zStop=He(r.inputMasking)}else window.reinitializationInProgress=!0,window.zStop=dt(),T("reinitializing the session on tabActive event")}catch(e){x("Failed to reinit on tab visibility. Error - "+e.message)}else{for(;window.zEventsData.length;)window.zEventsData.pop();var o=window.zStop;o&&o()}})}(e),function(e){window.addEventListener("beforeunload",function(t){try{window.zRootDomain&&ot(e)}catch(e){x("Failed to set CookieData on tab beforeunload. Error - "+e.message)}})}(e)});x("Not able to process as sdk api key null or invalid.")}()}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){x("Not able to init SDK: "+e.message)}))}catch(e){return Promise.reject(e)}},ct=function(e,t){void 0===t&&(t={});try{if(window.self!==window.parent)return}catch(e){x(e.message?e.message:e)}try{if(!window.sdkInit)return x("Identify: SDK not initialized"),void setTimeout(function(){T("Calling identify again after 10 seconds"),function(e,t,n){void 0===t&&(t={}),(st-=1)>0?ct(e,t):x("Identify session retries count exceeded")}(e,t)},1e4);if(!e||"string"!=typeof e||e.length<=0||e.trim().length<=0)return void x("Got wrong external UUID, Please validate: "+e);T("identify :: externalUUId - "+e);var n=Pe(),r=Re()||{},o=l.POSTENDUSERINFO,i=t;i.externalId=e;var s=!1;if(n){var a;n.userType==f.ANONYMS||(d=null==(a=n)?void 0:a.zExternalUserInfo,p=i,T("NewEndUserInfo :: "+JSON.stringify(p)),T("PrevEndUserInfo :: "+JSON.stringify(d)),(null==d?void 0:d.externalId)===(null==p?void 0:p.externalId)?o=l.POSTENDUSERINFOANDGETUSERCONFIG:(n.euId=0,n.euZName="",n.userType=f.ANONYMS,n.isBlocked=!1,s=!0,o=l.POSTENDUSERINFOANDGETUSERCONFIG,Ue(r.sdkKey),window.reinitializationInProgress=!0))}else{var c=xe();n={euId:0,euZName:"",userType:f.ANONYMS,isBlocked:!1,zExternalUserInfo:{},zAnonymsUserInfo:{zId:c,euId:0,euZName:""}}}window.iszHandshakeDone||(o=l.POSTENDUSERINFOANDGETUSERCONFIG),n.zExternalUserInfo=i,Ae(n);var u=we();u&&r?!s&&u.isBlocked?T("No need to do backend call if session is blocked"):Be(r.sdkKey,o,s).then(function(e){s&&(window.zStop=dt())}).catch(function(e){x("Failed to post/get sdk config from server: ")}):x("Value doesn't exists in sessionBlockInfo or sessionData : ")}catch(e){x("Not able to identify SDK: "+e.message)}var d,p},ut=function(){try{if(window.self!==window.parent)return}catch(e){x(e.message?e.message:e)}if(window.sdkInit){T("Going to anonymize end user");var e,t=!1;(((e=Pe())?e.userType===f.IDENTIFIED:(T("zenduser-info doesn't exists"),0))||function(){var e=_e();return e?e.userType===f.IDENTIFIED:(T("zenduser-info doesn't exists"),!1)}())&&(t=!0);var n=function(){var e=Pe();return e?(e.zExternalUserInfo={},e.userType=f.ANONYMS,qe(e,!1),e):(T("zenduser Data dosen't exists"),function(){var e=_e();if(e)return e.zExternalUserInfo={},e.userType=f.ANONYMS,qe(e,!0),e;T("zenduser Data dosen't exists in temp storage")}())}()||{},r=l.GETUSERCONFIG;0===n.euId?(r=l.POSTENDUSERINFOANDGETUSERCONFIG,Ae(n),Le(n)):(Le(n),Fe());var o=Re();o&&t?(window.reinitializationInProgress=!0,Ue(null==o?void 0:o.sdkKey),Be(null==o?void 0:o.sdkKey,r,!0).then(function(e){window.zStop=dt()}).catch(function(e){x("Failed to post/get sdk config from server: ")})):T("Identified user doesn't exists in system No need to break session")}else x("Anonymize: SDK not initialized")};function dt(e){var t=[];try{if(U("Zipy Recorder Reinit"),window.isDataSyncInProgress=!1,!window.stopRecording){T("Going to stop recording ");var n=window.zStop;n&&n()}window.iszInternetDisconnected=!1,window.zEventsPerfData=[],window.zClickEventsData=[],window.zFetchTempData=[],window.zEventsData=[],window.xhrTempData=[],window.stopRecording=!1;var r=j();if(r.domCapture){var o=He(r.inputMasking);t.push(o)}return t.push(We()),$e(r),window.reinitializationInProgress=!1,function(){try{window.stopRecording=!0,D("Calling zipy Stop Recorder"),t.forEach(function(e){return e()}),Qe()}catch(e){x("Failed to stop recording")}}}catch(e){x(e)}return function(){}}function lt(e,t){setTimeout(it,e,t)}var ft=function(){try{if(window.self!==window.parent)return""}catch(e){x(e.message?e.message:e)}try{var e=j(),t=fe("zsession-blocked-info"),n=JSON.parse(t);if(!window.sdkInit||n.is_blocked)return x("SessionLink: SDK not initialized"),"";var r=Re()||{},o=fe("zId");return e.customerId?b.sessionLinkUrl+"/"+r.sdkKey+"/"+e.customerId+"?is_error=false&id="+o+"&euid="+r.sessionId:(x("SessionLink: Could not find customer id"),"")}catch(e){return x("Error in generating session url. Error is - "+e.message),""}},pt=function(e,t){try{var n=j();if(!n||n&&!n.captureCustomZipyLogMessage)return void T("Custom Zipy Message not enabled.");if(e&&"string"==typeof e){var r=new CustomEvent(E,{detail:{message:e,options:t}});window.dispatchEvent(r)}else U("Mandatory params missing for zipy logs")}catch(e){U("Error in capturing zipy logs. Error - "+e.message)}},gt=function(e){try{var t=j();if(!t||t&&!t.captureCustomZipyLogMessage)return void T("Custom Zipy Exception not enabled.");if(e){var n=new CustomEvent(S,{detail:{error:e instanceof Error?e:{message:String(e)}}});window.dispatchEvent(n)}else U("Mandatory params missing for zipy exception missing")}catch(e){U("Error in capturing zipy exception event. Error - "+e.message)}},vt=function(e,t,n,r){try{var o=j();if(!o||o&&!o.captureCustomZipyLogError)return void T("Custom Zipy Error not enabled.");if(e&&t&&"string"==typeof e&&"string"==typeof t){var i=new CustomEvent(z,{detail:{name:e,message:t,category:n,options:r}});window.dispatchEvent(i)}else U("Mandatory params missing for zipy error logs")}catch(e){x("Error in capturing zipy error event. Error - "+e.message)}},yt={init:at,identify:ct,anonymize:ut,getCurrentSessionURL:ft,logError:vt,logException:gt,logMessage:pt};export{ut as anonymize,yt as default,ft as getCurrentSessionURL,ct as identify,at as init,vt as logError,gt as logException,pt as logMessage};
